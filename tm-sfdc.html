<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-elements/paper-elements.html">

<link rel="import" href="elements/tm-jsforce.html">

<link rel="import" href="tm-sfdc-login.html">
<link rel="import" href="tm-sfdc-services.html">

<!--
`tm-sfdc`


@demo demo/index.html
-->

<dom-module id="tm-sfdc">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    <h2>Connecting to SalesForce</h2>

    <paper-button raised on-tap="_getServices">Get Services</paper-button>
    <paper-dropdown-menu label="Services">
      <paper-listbox class="dropdown-content" selected="0">
        <template is="dom-repeat" items="[[serviceList]]" as="service">
            <paper-item data-path="[[service.path]]">[[service.name]]</paper-item>
        </template>
      </paper-listbox>
    </paper-dropdown-menu>

    <iron-ajax
      auto
      method="GET"
      url="private/login-data.json"
      handle-as="json"
      last-response="{{loginData}}">
    </iron-ajax>

    <tm-sfdc-login id="login"
      url="[[loginData.auth_url]]"
      client-id="[[loginData.client_id]]"
      client-secret="[[loginData.client_secret]]"
      username="[[loginData.username]]"
      password="[[loginData.password]]"
      response="{{oAuthData}}"
      error-message="{{oAuthErrorMessage}}"></tm-sfdc-login>

    <tm-sfdc-services id="services"
      base-url="[[oAuthData.instance_url]]"
      access-token="[[oAuthData.access_token]]"
      service-list="{{serviceList}}"></tm-sfdc-services>

  </template>

  <script>
    Polymer({
      is: 'tm-sfdc',
      properties: {
        loginData: { type: Object, notify: true },
        oAuthData: { type: Object, notify: true },
        oAuthErrorMessage: { type: String, notify: true },
        serviceList: { type: Array, notify: true, value: [] }
      },
      observers: [
        '_debug(login)'
      ],
      _debug: function(object) {
        console.log('SFDC DEBUG: ', object)
      },
      ready: function() {
        console.log('Created tm-sfdc component.');
      }
    });
  </script>
</dom-module>
